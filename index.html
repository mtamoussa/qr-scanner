<!-- Using html5-qrcode -->
<!-- <!DOCTYPE html>
<html>
<body>
    <div id="reader" width="600px"></div>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script>
        // Html5Qrcode.getCameras().then(devices => {
        //     if (devices && devices.length) {
        //         var cameraId = devices[0].id;
        //         const html5QrCode = new Html5Qrcode("reader");
        //         html5QrCode.start(
        //             cameraId,     // retreived in the previous step.
        //             {
        //                 fps: 10,    // sets the framerate to 10 frame per second
        //                 qrbox: 250  // sets only 250 X 250 region of viewfinder to
        //                 // scannable, rest shaded.
        //             },
        //             qrCodeMessage => {
        //                 // do something when code is read. For example:
        //                 console.log(`QR Code detected: ${qrCodeMessage}`);
        //                 // window.ReactNativeWebView.postMessage(scannedCode);
        //             },
        //             errorMessage => {
        //                 // parse error, ideally ignore it. For example:
        //                 console.log(`QR Code no longer in front of camera.`);
        //             })
        //             .catch(err => {
        //                 // Start failed, handle it. For example,
        //                 console.log(`Unable to start scanning, error: ${err}`);
        //             });
        //     }
        // }).catch(err => {
        //     // handle err
        //     console.error(err);
        // });


        navigator.mediaDevices.getUserMedia({ video: true, audio: false }).then(device => {
            if (device) {
                var cameraId = device.id;
                const html5QrCode = new Html5Qrcode("reader");
                html5QrCode.start(
                    cameraId,     // retreived in the previous step.
                    {
                        fps: 10,    // sets the framerate to 10 frame per second
                        qrbox: 250  // sets only 250 X 250 region of viewfinder to
                        // scannable, rest shaded.
                    },
                    qrCodeMessage => {
                        // do something when code is read. For example:
                        console.log(`QR Code detected: ${qrCodeMessage}`);
                        // window.ReactNativeWebView.postMessage(scannedCode);
                    },
                    errorMessage => {
                        // parse error, ideally ignore it. For example:
                        console.log(`QR Code no longer in front of camera.`);
                    })
                    .catch(err => {
                        // Start failed, handle it. For example,
                        console.log(`Unable to start scanning, error: ${err}`);
                    });
            }
        }).catch(err => {
            // handle err
            console.error(err);
        });
    </script>
</body>
</html> -->

<!-- From scratch using jsQr -->
<!DOCTYPE html>
<html>
<head></head>
<body>
    <div id="loadingMessage">ðŸŽ¥ Unable to access video stream (please make sure you have a webcam enabled)</div>
    <canvas id="canvas" hidden></canvas>
    <div id="output" hidden>
        <div id="outputMessage">No QR code detected.</div>
        <div hidden><b>Data:</b> <span id="outputData"></span></div>
    </div>
    <script src="jsqr/dist/jsQR.js"></script>
    <script>
        var video = document.createElement("video");
        var canvasElement = document.getElementById("canvas");
        var canvas = canvasElement.getContext("2d");
        var loadingMessage = document.getElementById("loadingMessage");
        var outputContainer = document.getElementById("output");
        var outputMessage = document.getElementById("outputMessage");
        var outputData = document.getElementById("outputData");

        function drawLine(begin, end, color) {
            canvas.beginPath();
            canvas.moveTo(begin.x, begin.y);
            canvas.lineTo(end.x, end.y);
            canvas.lineWidth = 4;
            canvas.strokeStyle = color;
            canvas.stroke();
        }

        // Use facingMode: environment to attempt to get the front camera on phones
        navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } }).then(function (stream) {
            video.srcObject = stream;
            video.setAttribute("playsinline", true); // required to tell iOS safari we don't want fullscreen
            video.play();
            requestAnimationFrame(tick);
        });

        function tick() {
            if (video.readyState === video.HAVE_ENOUGH_DATA) {
                loadingMessage.hidden = true;
                canvasElement.hidden = false;
                outputContainer.hidden = false;

                canvasElement.height = video.videoHeight;
                canvasElement.width = video.videoWidth;
                canvas.drawImage(video, 0, 0, canvasElement.width, canvasElement.height);
                var imageData = canvas.getImageData(0, 0, canvasElement.width, canvasElement.height);
                var code = jsQR(imageData.data, imageData.width, imageData.height, {
                    inversionAttempts: "dontInvert",
                });
                if (code) {
                    drawLine(code.location.topLeftCorner, code.location.topRightCorner, "#FF3B58");
                    drawLine(code.location.topRightCorner, code.location.bottomRightCorner, "#FF3B58");
                    drawLine(code.location.bottomRightCorner, code.location.bottomLeftCorner, "#FF3B58");
                    drawLine(code.location.bottomLeftCorner, code.location.topLeftCorner, "#FF3B58");
                    outputMessage.hidden = true;
                    outputData.parentElement.hidden = false;
                    outputData.innerText = code.data;
                    // window.ReactNativeWebView.postMessage(scanQRCode());
                } else {
                    outputMessage.hidden = false;
                    outputData.parentElement.hidden = true;
                }
            }
            requestAnimationFrame(tick);
        }
    </script>
</body>
</html>